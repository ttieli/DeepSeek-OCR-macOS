# ğŸ“– DeepSeek-OCR ä½¿ç”¨æŒ‡å—

## ğŸ‰ æˆåŠŸäº†ï¼

ä½ å·²ç»æˆåŠŸè¿è¡Œäº† DeepSeek-OCRï¼Œå¹¶å¾—åˆ°äº†æ­£ç¡®çš„è¯†åˆ«ç»“æœï¼

### âœ… è¯†åˆ«ç»“æœç¤ºä¾‹

ä»ä½ çš„æˆªå›¾ä¸­ï¼ŒOCR æˆåŠŸè¯†åˆ«å‡ºï¼š
- âœ… "5 åˆ›å»º Pull Request / Merge Request"
- âœ… "åœ¨ GitHub/GitLab ä¸Šåˆ›å»º PR/MRï¼Œè¯·æ±‚å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯"
- âœ… "6 ä»£ç å®¡æŸ¥ä¸åˆå¹¶"
- âœ… "å›¢é˜Ÿæˆå‘˜å®¡æŸ¥ä»£ç ï¼Œé€šè¿‡ååˆå¹¶åˆ°ä¸»åˆ†æ”¯"
- âœ… "æƒ…æ™¯äºŒï¼šæ—¥å¸¸åŒæ­¥æµç¨‹ï¼ˆæ¨èï¼‰"

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

1. **å‡†å¤‡å›¾ç‰‡**ï¼šå°†è¦è¯†åˆ«çš„å›¾ç‰‡æ”¾å…¥ `test_images/` ç›®å½•

```bash
# å¤åˆ¶å›¾ç‰‡åˆ°æµ‹è¯•ç›®å½•
cp /path/to/your/image.png test_images/
```

2. **è¿è¡Œæµ‹è¯•**ï¼š

```bash
cd "/Users/tieli/Library/Mobile Documents/com~apple~CloudDocs/Project/DeepSeek_OCR_for_MacOS"
bash test.sh
```

3. **æŸ¥çœ‹ç»“æœ**ï¼š

```bash
# æŸ¥çœ‹è¾“å‡ºç›®å½•
ls ocr_output/

# æ‰“å¼€ç»“æœ
open ocr_output/
```

### æ–¹å¼äºŒï¼šç¼–å†™è‡ªå·±çš„ Python è„šæœ¬

åˆ›å»ºæ–‡ä»¶ `my_ocr.py`ï¼š

```python
from transformers import AutoModel, AutoTokenizer
import torch
from pathlib import Path

# é…ç½®
model_name = 'deepseek-ai/DeepSeek-OCR'
device = "cpu"  # macOS ä¸Šä½¿ç”¨ CPU æ¨¡å¼æœ€ç¨³å®š

# åŠ è½½æ¨¡å‹ï¼ˆé¦–æ¬¡ä¼šä¸‹è½½çº¦ 10GBï¼‰
print("åŠ è½½æ¨¡å‹...")
tokenizer = AutoTokenizer.from_pretrained(model_name, trust_remote_code=True)
model = AutoModel.from_pretrained(
    model_name,
    trust_remote_code=True,
    use_safetensors=True
)
model = model.eval().to(torch.bfloat16).to(device)

# å‡†å¤‡è¾“å…¥
image_file = 'your_image.jpg'  # ä¿®æ”¹ä¸ºä½ çš„å›¾ç‰‡è·¯å¾„
output_path = 'output_dir'     # è¾“å‡ºç›®å½•

# é€‰æ‹©æç¤ºè¯ï¼ˆè§ä¸‹æ–¹æç¤ºè¯æ¨¡æ¿ï¼‰
prompt = "<image>\n<|grounding|>Convert the document to markdown."

# æ‰§è¡Œ OCR
print("å¼€å§‹è¯†åˆ«...")
result = model.infer(
    tokenizer,
    prompt=prompt,
    image_file=image_file,
    output_path=output_path,
    base_size=1024,      # åŸºç¡€åˆ†è¾¨ç‡
    image_size=640,      # å›¾åƒå°ºå¯¸
    crop_mode=True,      # å¯ç”¨è£å‰ªæ¨¡å¼
    save_results=True,   # ä¿å­˜ç»“æœ
    test_compress=True   # æµ‹è¯•å‹ç¼©
)

print("è¯†åˆ«å®Œæˆï¼")
print(f"ç»“æœä¿å­˜åœ¨: {output_path}")
```

è¿è¡Œï¼š
```bash
source ~/miniforge3/etc/profile.d/conda.sh
conda activate deepseek-ocr
python my_ocr.py
```

## ğŸ“ æç¤ºè¯æ¨¡æ¿ï¼ˆPrompt Templatesï¼‰

æ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„æç¤ºè¯ï¼š

### 1. æ–‡æ¡£è½¬ Markdownï¼ˆæ¨èï¼‰
```python
prompt = "<image>\n<|grounding|>Convert the document to markdown."
```
**ç”¨é€”**ï¼šå°†æ–‡æ¡£è½¬æ¢ä¸ºç»“æ„åŒ–çš„ Markdown æ ¼å¼
**è¾“å‡º**ï¼šMarkdown æ–‡æœ¬ + å›¾ç‰‡å¼•ç”¨

### 2. æ™®é€š OCR
```python
prompt = "<image>\n<|grounding|>OCR this image."
```
**ç”¨é€”**ï¼šæå–å›¾ç‰‡ä¸­çš„æ‰€æœ‰æ–‡å­—
**è¾“å‡º**ï¼šçº¯æ–‡æœ¬

### 3. æ— å¸ƒå±€ OCR
```python
prompt = "<image>\nFree OCR."
```
**ç”¨é€”**ï¼šä»…æå–æ–‡å­—ï¼Œä¸ä¿ç•™å¸ƒå±€
**è¾“å‡º**ï¼šè¿ç»­çš„æ–‡æœ¬æµ

### 4. å›¾è¡¨è§£æ
```python
prompt = "<image>\nParse the figure."
```
**ç”¨é€”**ï¼šè§£æå›¾è¡¨ã€å›¾å½¢å†…å®¹
**è¾“å‡º**ï¼šå›¾è¡¨æè¿° + æ•°æ®

### 5. è¯¦ç»†æè¿°
```python
prompt = "<image>\nDescribe this image in detail."
```
**ç”¨é€”**ï¼šè·å–å›¾ç‰‡çš„è¯¦ç»†æè¿°
**è¾“å‡º**ï¼šå›¾ç‰‡å†…å®¹çš„è¯¦ç»†è¯´æ˜

## ğŸ›ï¸ å‚æ•°è¯´æ˜

### åˆ†è¾¨ç‡æ¨¡å¼

æ ¹æ®å›¾ç‰‡å¤æ‚åº¦é€‰æ‹©åˆé€‚çš„åˆ†è¾¨ç‡ï¼š

```python
# Tiny - ç®€å•æ–‡æ¡£ï¼ˆ512Ã—512ï¼‰
base_size=512, image_size=384

# Small - ä¸€èˆ¬æ–‡æ¡£ï¼ˆ640Ã—640ï¼‰
base_size=640, image_size=480

# Base - æ¨èè®¾ç½®ï¼ˆ1024Ã—1024ï¼‰â­
base_size=1024, image_size=640

# Large - å¤æ‚æ–‡æ¡£ï¼ˆ1280Ã—1280ï¼‰
base_size=1280, image_size=800
```

**å»ºè®®**ï¼š
- ç®€å•æ–‡æ¡£ï¼šä½¿ç”¨ Tiny æˆ– Smallï¼ˆé€Ÿåº¦å¿«ï¼‰
- ä¸€èˆ¬æ–‡æ¡£ï¼šä½¿ç”¨ Baseï¼ˆå¹³è¡¡ï¼‰
- å¤æ‚/é«˜æ¸…æ–‡æ¡£ï¼šä½¿ç”¨ Largeï¼ˆç²¾åº¦é«˜ï¼‰

### å…¶ä»–å‚æ•°

```python
crop_mode=True       # å¯ç”¨è£å‰ªæ¨¡å¼ï¼ˆæ¨èï¼‰
save_results=True    # ä¿å­˜ç»“æœæ–‡ä»¶
test_compress=True   # å¯ç”¨å‹ç¼©æµ‹è¯•
```

## ğŸ“ è¾“å‡ºæ–‡ä»¶è¯´æ˜

OCR å®Œæˆåï¼Œä¼šåœ¨è¾“å‡ºç›®å½•ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
output_dir/
  â””â”€â”€ [å›¾ç‰‡åç§°]/
      â”œâ”€â”€ result.mmd                  # Markdown æ ¼å¼ç»“æœ â­
      â”œâ”€â”€ result_with_boxes.jpg       # å¸¦æ ‡æ³¨æ¡†çš„å›¾ç‰‡
      â”œâ”€â”€ [å›¾ç‰‡åç§°]_result.md        # å®Œæ•´è¯†åˆ«ç»“æœ
      â””â”€â”€ images/                     # æå–çš„å›¾ç‰‡ç‰‡æ®µ
          â”œâ”€â”€ 0.jpg
          â”œâ”€â”€ 1.jpg
          â””â”€â”€ 2.jpg
```

**ä¸»è¦æ–‡ä»¶**ï¼š
- **`result.mmd`** - æœ€é‡è¦çš„æ–‡ä»¶ï¼ŒåŒ…å«è¯†åˆ«çš„æ–‡æœ¬å’Œç»“æ„
- **`result_with_boxes.jpg`** - å¯è§†åŒ–ç»“æœï¼Œæ˜¾ç¤ºè¯†åˆ«åŒºåŸŸ
- **`images/`** - æå–çš„å›¾ç‰‡åŒºåŸŸ

## ğŸ’¡ å®ç”¨æŠ€å·§

### æ‰¹é‡å¤„ç†å¤šå¼ å›¾ç‰‡

```python
from pathlib import Path
import glob

# å¤„ç†ç›®å½•ä¸­çš„æ‰€æœ‰å›¾ç‰‡
image_dir = Path("test_images")
for image_path in image_dir.glob("*.png"):
    print(f"å¤„ç†: {image_path.name}")

    output_dir = Path("ocr_output") / image_path.stem
    output_dir.mkdir(parents=True, exist_ok=True)

    result = model.infer(
        tokenizer,
        prompt="<image>\n<|grounding|>Convert the document to markdown.",
        image_file=str(image_path),
        output_path=str(output_dir),
        base_size=1024,
        image_size=640,
        crop_mode=True,
        save_results=True
    )

    print(f"âœ“ å®Œæˆ: {output_dir}")
```

### æé«˜è¯†åˆ«é€Ÿåº¦

1. **é™ä½åˆ†è¾¨ç‡**ï¼šä½¿ç”¨ Small æ¨¡å¼
2. **ç¦ç”¨å‹ç¼©æµ‹è¯•**ï¼š`test_compress=False`
3. **æ‰¹é‡å¤„ç†**ï¼šä¸€æ¬¡åŠ è½½æ¨¡å‹ï¼Œå¤„ç†å¤šå¼ å›¾ç‰‡

### æé«˜è¯†åˆ«ç²¾åº¦

1. **æé«˜åˆ†è¾¨ç‡**ï¼šä½¿ç”¨ Large æ¨¡å¼
2. **å¯ç”¨è£å‰ªæ¨¡å¼**ï¼š`crop_mode=True`
3. **ä½¿ç”¨åˆé€‚çš„æç¤ºè¯**ï¼šæ ¹æ®æ–‡æ¡£ç±»å‹é€‰æ‹©

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ€§èƒ½

- **é¦–æ¬¡è¿è¡Œæ…¢**ï¼šæ¨¡å‹å·²ä¸‹è½½ï¼Œä½†åŠ è½½éœ€è¦æ—¶é—´
- **CPU æ¨¡å¼**ï¼šæ¯å¼ å›¾çº¦ 3-5 åˆ†é’Ÿ
- **å†…å­˜ä½¿ç”¨**ï¼šçº¦ 3-4GB

### å›¾ç‰‡æ ¼å¼

æ”¯æŒçš„æ ¼å¼ï¼š
- âœ… PNG
- âœ… JPG/JPEG
- âœ… BMP
- âœ… WEBP
- âœ… PDFï¼ˆéœ€è¦é¢å¤–å¤„ç†ï¼‰

### æœ€ä½³å®è·µ

1. **å›¾ç‰‡è´¨é‡**ï¼šä½¿ç”¨æ¸…æ™°çš„é«˜åˆ†è¾¨ç‡å›¾ç‰‡
2. **æ–‡å­—å¤§å°**ï¼šç¡®ä¿æ–‡å­—æ¸…æ™°å¯è¯»
3. **å›¾ç‰‡æ–¹å‘**ï¼šæ­£å‘å›¾ç‰‡è¯†åˆ«æ•ˆæœæœ€å¥½
4. **æ‰¹é‡å¤„ç†**ï¼šä¸€æ¬¡åŠ è½½æ¨¡å‹ï¼Œå¤„ç†å¤šå¼ å›¾ç‰‡

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: è¯†åˆ«ç»“æœä¸å‡†ç¡®ï¼Ÿ

**A**: å°è¯•ï¼š
1. æé«˜åˆ†è¾¨ç‡ï¼šä½¿ç”¨ `base_size=1280`
2. æ›´æ¢æç¤ºè¯ï¼šæ ¹æ®å†…å®¹ç±»å‹é€‰æ‹©
3. æ£€æŸ¥å›¾ç‰‡è´¨é‡ï¼šç¡®ä¿æ¸…æ™°å¯è¯»

### Q: è¿è¡Œé€Ÿåº¦å¤ªæ…¢ï¼Ÿ

**A**: æ­£å¸¸ç°è±¡
- CPU æ¨¡å¼ä¸‹ï¼Œæ¯å¼ å›¾ 3-5 åˆ†é’Ÿæ˜¯æ­£å¸¸çš„
- å¯ä»¥é™ä½åˆ†è¾¨ç‡åŠ å¿«é€Ÿåº¦

### Q: å†…å­˜ä¸è¶³ï¼Ÿ

**A**:
- CPU æ¨¡å¼åªéœ€ 3-4GB
- å…³é—­å…¶ä»–åº”ç”¨é‡Šæ”¾å†…å­˜
- é™ä½åˆ†è¾¨ç‡å‚æ•°

## ğŸ“Š æ€§èƒ½åŸºå‡†

åŸºäº macOS + CPU æ¨¡å¼ï¼š

| åˆ†è¾¨ç‡ | å†…å­˜ | é€Ÿåº¦ï¼ˆæ¯å¼ ï¼‰ | é€‚ç”¨åœºæ™¯ |
|--------|------|--------------|----------|
| Tiny (512) | 2-3GB | 1-2åˆ†é’Ÿ | ç®€å•æ–‡æ¡£ |
| Small (640) | 2-3GB | 2-3åˆ†é’Ÿ | ä¸€èˆ¬æ–‡æ¡£ |
| Base (1024) | 3-4GB | 3-5åˆ†é’Ÿ | æ¨èä½¿ç”¨ â­ |
| Large (1280) | 4-5GB | 5-8åˆ†é’Ÿ | å¤æ‚æ–‡æ¡£ |

## ğŸ¯ å¿«é€Ÿå¼€å§‹

1. **æ”¾å…¥å›¾ç‰‡**ï¼š
```bash
cp your_image.png test_images/
```

2. **è¿è¡Œæµ‹è¯•**ï¼š
```bash
bash test.sh
```

3. **æŸ¥çœ‹ç»“æœ**ï¼š
```bash
open ocr_output/
```

---

**ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä½¿ç”¨ DeepSeek-OCR äº†ï¼** ğŸ‰

æœ‰ä»»ä½•é—®é¢˜ï¼ŒæŸ¥çœ‹ `CPUæ¨¡å¼è¯´æ˜.md` æˆ– `æœ€ç»ˆæµ‹è¯•æŒ‡å—.md`ã€‚
