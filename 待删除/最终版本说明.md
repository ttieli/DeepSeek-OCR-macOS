# 🎉 DeepSeek-OCR macOS 最终版本

## ✅ 整理完成

已将所有功能整合到 **4 个核心文件**：

### 核心文件

1. **`install.sh`** ⭐ - 一键安装
   - 自动安装 Conda 环境
   - 下载 DeepSeek-OCR 模型
   - 配置 macOS 优化

2. **`ocr.sh`** ⭐ - 一键使用
   - 交互式选择识别模式
   - 自动处理所有图片
   - 自动转换格式

3. **`fix_cuda.py`** - 自动修复
   - 修复 CUDA 兼容性
   - 自动调用，无需手动运行

4. **`convert_mmd.py`** - 自动转换
   - 转换 .mmd 为标准 Markdown
   - 自动调用，无需手动运行

---

## 🚀 使用方法

### 首次使用（安装）

```bash
bash install.sh
```

**约需 10-20 分钟**，全自动完成所有配置。

### 日常使用

```bash
# 1. 放入图片
cp your_image.png test_images/

# 2. 运行
bash ocr.sh

# 3. 选择模式（1-5）
请输入选项（1-5）[默认: 1]: 1

# 4. 查看结果
open ocr_output/
```

---

## 📝 功能特性

### ✨ 交互式选择

运行 `bash ocr.sh` 会显示菜单：

```
请选择 OCR 识别模式：

  1. 文档转 Markdown（推荐）
  2. 普通 OCR
  3. 无布局 OCR
  4. 图表解析
  5. 详细描述

请输入选项（1-5）[默认: 1]:
```

### 🔧 自动处理

- ✅ 自动修复 CUDA 兼容性
- ✅ 自动转换 .mmd 为 .md
- ✅ 自动批量处理多张图片
- ✅ 自动创建输出目录

### 📊 输出文件

每张图片生成：
- `result.mmd` - 原始输出
- `result_标准格式.md` - 标准 Markdown ⭐
- `result_with_boxes.jpg` - 带标注图片
- `images/` - 提取的图片

---

## 📁 文件结构

### 最简配置（5个文件）

```
DeepSeek_OCR_for_MacOS/
├── install.sh          ⭐ 安装脚本
├── ocr.sh              ⭐ 使用脚本
├── fix_cuda.py         兼容性修复
├── convert_mmd.py      格式转换
└── 开始使用.md          快速指南
```

### 完整配置（包含文档）

```
DeepSeek_OCR_for_MacOS/
├── install.sh
├── ocr.sh
├── fix_cuda.py
├── convert_mmd.py
├── 开始使用.md          ⭐ 快速入门
├── 使用说明.txt         详细说明
├── 文件清单.md          文件管理
├── 最终版本说明.md      本文件
├── test_images/        输入目录
└── ocr_output/         输出目录
```

---

## 🎯 与旧版本的区别

### 旧版本（多个脚本）

- ❌ test.sh
- ❌ run_ocr_test.py
- ❌ deploy_deepseek_ocr.sh
- ❌ fix_mps_support.py
- ❌ ...等 10+ 个文件

### 新版本（4个核心文件）

- ✅ install.sh（整合了所有安装功能）
- ✅ ocr.sh（整合了所有使用功能）
- ✅ fix_cuda.py（自动调用）
- ✅ convert_mmd.py（自动调用）

---

## 💡 特别说明

### 为什么使用 CPU 模式？

根据 Hugging Face 社区测试：

| 模式 | 内存 | 速度 | 稳定性 | 输出质量 |
|-----|------|------|--------|---------|
| MPS + Fallback | 19GB | 慢 | ❌ 不稳定 | ❌ 乱码 |
| **CPU** | **3GB** | **更快** | **✅ 稳定** | **✅ 准确** |

**CPU 模式在 macOS 上反而更好！**

### 为什么转换 .mmd 格式？

DeepSeek-OCR 输出 `.mmd`（MultiModal Markdown）格式：
- 包含 HTML 表格
- 部分编辑器不支持

自动转换为标准 `.md` 格式：
- 兼容所有 Markdown 编辑器
- 更易阅读和编辑

---

## 📊 性能参考

- **设备**：CPU 模式
- **内存**：约 3-4GB
- **速度**：每张图片 3-5 分钟
- **首次运行**：需下载模型约 10GB

---

## 🔍 常见问题

### Q: 需要安装什么？
**A**: 只需运行 `bash install.sh`，全自动安装

### Q: 支持哪些图片？
**A**: PNG, JPG, JPEG, BMP, WEBP

### Q: 如何批量处理？
**A**: 将多张图片放入 test_images/，运行 `bash ocr.sh`

### Q: 结果在哪里？
**A**: `ocr_output/` 目录，每张图片一个子目录

### Q: 可以修改参数吗？
**A**: 可以编辑 `ocr.sh` 中的 `base_size` 和 `image_size`

---

## 🧹 清理旧文件

如果之前有旧版本文件，可以删除：

```bash
# 删除旧脚本
rm -f test.sh run_ocr_test.py deploy_deepseek_ocr.sh
rm -f fix_mps_support.py install_dependencies.sh
rm -f run_ocr_test.sh save_test_image.py test_ocr.py
rm -f 一键运行.sh convert_mmd_to_md.py

# 删除旧输出目录
rm -rf output/
```

**保留核心 4 个文件 + 文档即可！**

---

## 🎉 开始使用

```bash
# 完整流程
bash install.sh              # 首次安装（10-20分钟）
cp image.png test_images/    # 放入图片
bash ocr.sh                  # 运行识别
# 选择模式: 1 ⏎
open ocr_output/             # 查看结果
```

---

## 📚 相关文档

- **开始使用.md** - 快速入门指南 ⭐
- **使用说明.txt** - 详细使用说明
- **文件清单.md** - 文件管理指南

---

**最终版本，简单高效！** 🚀
